{
  "format": "encoder-circuit-recipe",
  "version": "1.0.0",
  "metadata": {
    "name": "AES-128 Encryption Circuit",
    "description": "Complete AES-128 encryption implementation using visual circuit blocks",
    "author": "Circuit Designer",
    "created": "2024-01-01T00:00:00Z",
    "tags": ["crypto", "aes", "encryption", "advanced"],
    "category": "cryptography"
  },
  "circuit": {
    "nodes": {
      "plaintext_input": {
        "type": "source",
        "name": "Plaintext Input",
        "description": "16-byte plaintext block",
        "inputs": [],
        "outputs": ["output"],
        "position": { "x": 50, "y": 200 },
        "color": "#4CAF50"
      },
      "key_input": {
        "type": "source", 
        "name": "AES Key Input",
        "description": "128-bit encryption key",
        "inputs": [],
        "outputs": ["output"],
        "position": { "x": 50, "y": 100 },
        "color": "#4CAF50"
      },
      "key_expansion": {
        "type": "processor",
        "name": "Key Expansion",
        "description": "Generate 11 round keys from master key",
        "operation": "aes_key_expansion",
        "inputs": ["key"],
        "outputs": ["round_keys"],
        "position": { "x": 200, "y": 100 },
        "color": "#F44336"
      },
      "initial_round": {
        "type": "processor",
        "name": "Initial AddRoundKey",
        "description": "XOR plaintext with first round key",
        "operation": "add_round_key",
        "inputs": ["state", "round_key"],
        "outputs": ["state"],
        "parameters": { "round": 0 },
        "position": { "x": 200, "y": 200 },
        "color": "#2196F3"
      },
      "round_1_sbox": {
        "type": "processor",
        "name": "Round 1 - S-Box",
        "operation": "aes_sbox",
        "inputs": ["input"],
        "outputs": ["output"],
        "position": { "x": 350, "y": 150 },
        "color": "#2196F3"
      },
      "round_1_shift": {
        "type": "processor", 
        "name": "Round 1 - Shift Rows",
        "operation": "shift_rows",
        "inputs": ["input"],
        "outputs": ["output"],
        "position": { "x": 500, "y": 150 },
        "color": "#2196F3"
      },
      "round_1_mix": {
        "type": "processor",
        "name": "Round 1 - Mix Columns", 
        "operation": "mix_columns",
        "inputs": ["input"],
        "outputs": ["output"],
        "position": { "x": 650, "y": 150 },
        "color": "#2196F3"
      },
      "round_1_key": {
        "type": "processor",
        "name": "Round 1 - Add Round Key",
        "operation": "add_round_key",
        "inputs": ["state", "round_key"],
        "outputs": ["state"], 
        "parameters": { "round": 1 },
        "position": { "x": 800, "y": 150 },
        "color": "#2196F3"
      },
      "rounds_2_to_9": {
        "type": "processor",
        "name": "Rounds 2-9 (Loop)",
        "description": "Execute main AES rounds 2 through 9",
        "operation": "aes_main_rounds_loop",
        "inputs": ["state", "round_keys"],
        "outputs": ["state"],
        "parameters": { 
          "start_round": 2,
          "end_round": 9,
          "loop_count": 8
        },
        "position": { "x": 950, "y": 200 },
        "color": "#9C27B0"
      },
      "final_sbox": {
        "type": "processor",
        "name": "Final - S-Box",
        "operation": "aes_sbox", 
        "inputs": ["input"],
        "outputs": ["output"],
        "position": { "x": 1100, "y": 150 },
        "color": "#FF5722"
      },
      "final_shift": {
        "type": "processor",
        "name": "Final - Shift Rows",
        "operation": "shift_rows",
        "inputs": ["input"],
        "outputs": ["output"], 
        "position": { "x": 1250, "y": 150 },
        "color": "#FF5722"
      },
      "final_key": {
        "type": "processor",
        "name": "Final - Add Round Key",
        "operation": "add_round_key",
        "inputs": ["state", "round_key"],
        "outputs": ["ciphertext"],
        "parameters": { "round": 10 },
        "position": { "x": 1400, "y": 150 },
        "color": "#FF5722"
      },
      "ciphertext_output": {
        "type": "sink",
        "name": "Ciphertext Output",
        "description": "Final encrypted 16-byte block",
        "inputs": ["input"],
        "outputs": [],
        "position": { "x": 1550, "y": 200 },
        "color": "#FF9800"
      }
    },
    "connections": [
      {
        "from": "plaintext_input",
        "output": "output",
        "to": "initial_round",
        "input": "state"
      },
      {
        "from": "key_input", 
        "output": "output",
        "to": "key_expansion",
        "input": "key"
      },
      {
        "from": "key_expansion",
        "output": "round_keys",
        "to": "initial_round", 
        "input": "round_key"
      },
      {
        "from": "initial_round",
        "output": "state",
        "to": "round_1_sbox",
        "input": "input"
      },
      {
        "from": "round_1_sbox",
        "output": "output", 
        "to": "round_1_shift",
        "input": "input"
      },
      {
        "from": "round_1_shift",
        "output": "output",
        "to": "round_1_mix",
        "input": "input"
      },
      {
        "from": "round_1_mix",
        "output": "output",
        "to": "round_1_key",
        "input": "state"
      },
      {
        "from": "key_expansion",
        "output": "round_keys",
        "to": "round_1_key",
        "input": "round_key"
      },
      {
        "from": "round_1_key",
        "output": "state",
        "to": "rounds_2_to_9",
        "input": "state"
      },
      {
        "from": "key_expansion",
        "output": "round_keys", 
        "to": "rounds_2_to_9",
        "input": "round_keys"
      },
      {
        "from": "rounds_2_to_9",
        "output": "state",
        "to": "final_sbox",
        "input": "input"
      },
      {
        "from": "final_sbox",
        "output": "output",
        "to": "final_shift",
        "input": "input"
      },
      {
        "from": "final_shift",
        "output": "output",
        "to": "final_key",
        "input": "state"
      },
      {
        "from": "key_expansion",
        "output": "round_keys",
        "to": "final_key",
        "input": "round_key"
      },
      {
        "from": "final_key",
        "output": "ciphertext",
        "to": "ciphertext_output",
        "input": "input"
      }
    ]
  },
  "sequences": [
    {
      "id": "aes_main_rounds_loop",
      "name": "AES Main Rounds Loop",
      "type": "loop",
      "loopCount": 8,
      "steps": [
        {
          "operation": "aes_sbox",
          "input": "state",
          "outputVariable": "state"
        },
        {
          "operation": "shift_rows", 
          "input": "state",
          "outputVariable": "state"
        },
        {
          "operation": "mix_columns",
          "input": "state", 
          "outputVariable": "state"
        },
        {
          "operation": "add_round_key",
          "input": "state",
          "outputVariable": "state",
          "parameters": {
            "round_key": "$round_keys[$loopIndex + 2]"
          }
        }
      ]
    }
  ],
  "operations": {
    "aes_key_expansion": {
      "description": "Expand 128-bit key into 11 round keys",
      "parameters": [],
      "implementation": "native"
    },
    "aes_sbox": {
      "description": "Apply AES S-Box substitution",
      "parameters": [],
      "implementation": "native"
    },
    "shift_rows": {
      "description": "Apply ShiftRows transformation",
      "parameters": [],
      "implementation": "native" 
    },
    "mix_columns": {
      "description": "Apply MixColumns transformation",
      "parameters": [],
      "implementation": "native"
    },
    "add_round_key": {
      "description": "XOR state with round key",
      "parameters": ["round"],
      "implementation": "native"
    }
  },
  "testVectors": [
    {
      "name": "NIST Test Vector 1",
      "plaintext": "00112233445566778899aabbccddeeff",
      "key": "000102030405060708090a0b0c0d0e0f",
      "expected_ciphertext": "69c4e0d86a7b0430d8cdb78070b4c55a"
    }
  ],
  "validation": {
    "nodeCount": 12,
    "connectionCount": 15,
    "hasLoops": true,
    "complexity": "high",
    "estimatedExecutionTime": "50ms"
  }
}